{% extends 'dashboard.html' %}


    {% block head %}
  
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">



    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

   
        @media (max-width: 768px) {
            .container {
                padding: 0 10px;
                margin: 10px auto;
            }
        }

        .card {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
            width: 100%;
        }

        @media (max-width: 768px) {
            .card {
                padding: 15px;
                margin-bottom: 15px;
            }
        }

        h2 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
        }

        h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .form-group {
            margin-bottom: 15px;
            width: 100%;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .required::after {
            content: " *";
            color: #e74c3c;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-control:focus {
            outline: none;
            border-color: #3498db;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: #f05a28;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            text-align: center;
            text-decoration: none;
        }

        .btn-primary {
            background-color: #f05a28;
        }

        .btn-secondary {
            background-color: #222;
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid #f05a28;
            color: #f05a28;
        }

        .btn-outline:hover {
            background-color: #f05a28;
            color: #fff;
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        .row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
        }

        .col {
            flex: 1;
            padding: 0 10px;
            min-width: 250px; /* Ensure columns don't get too narrow */
        }

        @media (max-width: 768px) {
            .row {
                flex-direction: column;
                margin: 0;
            }
            
            .col {
                width: 100%;
                padding: 0;
                margin-bottom: 15px;
            }
        }

        .product-type {
            display: flex;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .product-type-option {
            flex: 1;
            text-align: center;
            padding: 10px;
            background-color: #fff;
            border: 1px solid #ddd;
            cursor: pointer;
            min-width: 80px;
        }

        .product-type-option.active {
            background-color: #f05a28;
            color: #fff;
            border-color: #f05a28;
        }

        .product-type-option:first-child {
            border-radius: 4px 0 0 4px;
        }

        .product-type-option:last-child {
            border-radius: 0 4px 4px 0;
        }

        .tag {
            display: inline-block;
            background-color: #f5f5f5;
            padding: 5px 10px;
            border-radius: 4px;
            margin-right: 5px;
            margin-bottom: 5px;
            font-size: 12px;
        }

        .tag .close {
            margin-left: 5px;
            cursor: pointer;
            color: #777;
        }

        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        @media (max-width: 576px) {
            .gallery {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }
        }

        .gallery-item {
            position: relative;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
            aspect-ratio: 1/1;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gallery-item .remove {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: rgba(255, 255, 255, 0.8);
            color: #e74c3c;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
        }

        .editor-toolbar {
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 4px 4px 0 0;
            padding: 5px;
            background-color: #f9f9f9;
            display: flex;
            flex-wrap: wrap;
        }

        .editor-toolbar button {
            background: none;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            color: #333;
        }

        .editor-toolbar button:hover {
            background-color: #eee;
        }

        .editor-toolbar button.active {
            background-color: #e0e0e0;
        }

        .editor-content {
            border: 1px solid #ddd;
            border-radius: 0 0 4px 4px;
            min-height: 150px;
            padding: 10px;
            overflow-y: auto;
        }

        [contenteditable="true"]:focus {
            outline: none;
        }

        .select-wrapper {
            position: relative;
        }

        .select-wrapper::after {
            content: "\f107";
            font-family: "Font Awesome 5 Free";
            font-weight: 900;
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
        }

        .attribute-tags {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .attribute-values {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .attribute-value {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }

        .attribute-value.selected {
            background-color: #f05a28;
            color: white;
            border-color: #f05a28;
        }

        .variation-row {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .variation-title {
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .variation-title-badge {
            display: inline-block;
            background-color: #f05a28;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-right: 10px;
        }

        .variation-image {
            width: 80px;
            height: 80px;
            border: 1px dashed #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .variation-image img {
            max-width: 100%;
            max-height: 100%;
        }

        .file-input {
            display: none;
        }

        .attribute-section {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .attribute-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .attribute-section-title {
            font-weight: 600;
        }

        .attribute-section-remove {
            color: #e74c3c;
            cursor: pointer;
        }

        .dropzone {
            border: 2px dashed #ddd;
            border-radius: 4px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            margin-bottom: 15px;
        }

        .dropzone:hover {
            border-color: #aaa;
        }

        .dropzone i {
            font-size: 24px;
            color: #aaa;
            margin-bottom: 10px;
        }

        .dropzone p {
            color: #777;
            margin: 0;
        }

        .variations-group {
            margin-bottom: 30px;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
            background-color: #fafafa;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: #f05a28;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 576px) {
            .btn {
                padding: 8px 15px;
                font-size: 13px;
            }
            
            .editor-toolbar {
                overflow-x: auto;
                white-space: nowrap;
                padding: 3px;
            }
            
            .editor-toolbar button {
                padding: 3px 6px;
            }
        }
    </style>

    {% endblock %}




{% block body %}
    <div class="container">
        <!-- Initial Create Product Form -->

        <div id="loading-spinner" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center">
            <div class="animate-spin rounded-full h-12 w-12 border-t-4 border-blue-500"></div>
        </div>
        
        <div id="toast" class="fixed bottom-5 right-5 bg-green-500 text-white px-4 py-2 rounded shadow-lg"></div>
         
        <div class="card" id="initial-form">
            <h2>Create Product</h2>
            <form id="create-product-form">
                <div class="form-group">
                    <label class="required">Title</label>
                    <input type="text" class="form-control" id="initial-title" placeholder="Title">
                </div>
                <div class="form-group">
                    <label class="required">Slug</label>
                    <input type="text" class="form-control" id="initial-slug" placeholder="Slug" readonly>
                </div>
                <div class="form-group">
                    <label class="required">Category</label>
                    <div class="select-wrapper">
                        <select class="form-control" id="initial-category">
                            <option value="">Select Category</option>
                            <!-- Categories will be loaded from server -->
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label>Brand</label>
                            <div class="select-wrapper">
                                <select class="form-control" id="initial-brand">
                                    <option value="">Select Brand</option>
                                    <!-- Brands will be loaded from server -->
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label class="required">Product Type</label>
                            <div class="product-type">
                                <div class="product-type-option active" data-type="simple">Simple</div>
                                <div class="product-type-option" data-type="combo">Combo</div>
                                <div class="product-type-option" data-type="variable">Variable</div>
                            </div>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn btn-primary btn-block" id="create-product-btn">Create Product</button>
            </form>
        </div>

        <!-- Full Product Form (initially hidden) -->
        <div id="full-form" style="display: none;">
            <form id="full-product-form">
                <!-- Product Info Section -->
                <div class="card">
                    <div class="row">
                        <div class="col" style="flex: 3;">
                            <h2>Product Info</h2>
                            <div class="form-group">
                                <label class="required">Title</label>
                                <input type="text" class="form-control" id="full-title" name="title" value="">
                            </div>
                            <div class="form-group">
                                <label class="required">Slug</label>
                                <input type="text" class="form-control" id="full-slug" name="slug" value="" readonly>
                            </div>
                            <div class="form-group">
                                <label class="required">Category</label>
                                <div class="attribute-tags" id="category-tags">
                                    <!-- Tags will be added dynamically -->
                                </div>
                                <input type="hidden" id="category-input" name="category" value="">
                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <label>Brand</label>
                                        <div class="select-wrapper">
                                            <select class="form-control" id="full-brand" name="brand">
                                                <option value="">Select Brand</option>
                                                <!-- Brands will be loaded from server -->
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-group">
                                        <label class="required">Status</label>
                                        <div class="select-wrapper">
                                            <select class="form-control" id="status" name="status">
                                                <option value="active">Active</option>
                                                <option value="inactive">Inactive</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col" style="flex: 1; display: flex; justify-content: flex-end; align-items: flex-start;">
                           
                        </div>
                    </div>
                </div>

                <!-- Main Content Section -->
                <div class="row">
                    <div class="col" style="flex: 3;">




                        <div class="card">
                            <h2>Price & Stock</h2>
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <label class="required">Stock Quantity</label>
                                        <input value="0" type="number" class="form-control" id="stock-qty" name="stock_qty" placeholder="Stock Quantity">
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-group">
                                        <label class="required">Regular Price</label>
                                        <input value="0" type="number" class="form-control" id="regular-price" name="regular_price" placeholder="Regular Price">
                                    </div>
                                </div>
                           
                           
                                <div class="col">
                                    <div class="form-group">
                                        <label>Sale Price</label>
                                        <input value="0" type="number" class="form-control" id="sale-price" name="sale_price" placeholder="Sale Price">
                                    </div>
                                </div>
                            </div>
                               
                        
                        </div>



                        <!-- Variations Section -->
                        <div class="card">
                            <h2>Variations</h2>
                            <div id="attributes-container">
                                <!-- Attribute sections will be added here -->
                                <div class="attribute-section" data-index="0">
                                    <div class="attribute-section-header">
                                        <div class="attribute-section-title">Attribute 1</div>
                                        <div class="attribute-section-remove" style="display: none;"><i class="fas fa-times"></i></div>
                                    </div>
                                    <div class="row">
                                        <div class="col">
                                            <div class="form-group">
                                                <label>Attribute</label>
                                                <div class="select-wrapper">
                                                    <select class="form-control attribute-select" data-index="0">
                                                        <option value="">Select Attribute</option>
                                                        <!-- Attributes will be loaded from server -->
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="form-group">
                                                <label>Value</label>
                                                <div class="attribute-values" data-index="0">
                                                    <!-- Values will be added dynamically based on selected attribute -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row" style="margin-top: 15px;">
                                <div class="col">
                                    <button type="button" class="btn btn-outline" id="add-attribute-btn">
                                        <i class="fas fa-plus"></i> Add Another Attribute
                                    </button>
                                </div>
                                <div class="col" style="text-align: right;">
                                    <button type="button" class="btn btn-primary" id="generate-variations-btn">Generate Variations</button>
                                </div>
                            </div>

                            <!-- Variations Container -->
                            <div id="variations-container" style="margin-top: 20px;">
                                <!-- Variation rows will be added here dynamically -->
                            </div>
                        </div>

                        <!-- SEO Section -->
                        <div class="card">
                            <h2>SEO</h2>
                            <div class="form-group">
                                <label>Title</label>
                                <input type="text" class="form-control" id="seo-title" name="seo_title" value="">
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea class="form-control" id="seo-description" name="seo_description" rows="5"></textarea>
                            </div>
                        </div>

                        <!-- Description Section -->
                        <div class="card">
                            <h2>Description</h2>
                            <div class="form-group">
                                <label>Description</label>
                                <div class="editor-toolbar" id="description-toolbar">
                                    <button type="button" data-command="bold"><i class="fas fa-bold"></i></button>
                                    <button type="button" data-command="italic"><i class="fas fa-italic"></i></button>
                                    <button type="button" data-command="underline"><i class="fas fa-underline"></i></button>
                                    <button type="button" data-command="strikeThrough"><i class="fas fa-strikethrough"></i></button>
                                    <button type="button" data-command="formatBlock" data-value="h1">H1</button>
                                    <button type="button" data-command="formatBlock" data-value="h2">H2</button>
                                    <button type="button" data-command="formatBlock" data-value="h3">H3</button>
                                    <button type="button" data-command="justifyLeft"><i class="fas fa-align-left"></i></button>
                                    <button type="button" data-command="justifyCenter"><i class="fas fa-align-center"></i></button>
                                    <button type="button" data-command="justifyRight"><i class="fas fa-align-right"></i></button>
                                    <button type="button" data-command="insertUnorderedList"><i class="fas fa-list-ul"></i></button>
                                    <button type="button" data-command="insertOrderedList"><i class="fas fa-list-ol"></i></button>
                                    <button type="button" data-command="createLink"><i class="fas fa-link"></i></button>
                                    <button type="button" data-command="unlink"><i class="fas fa-unlink"></i></button>
                                    <button type="button" data-command="insertImage"><i class="fas fa-image"></i></button>
                                </div>
                                <div class="editor-content" id="description" contenteditable="true"></div>
                                <input type="hidden" id="description-input" name="description">
                            </div>
                        </div>
                    </div>
                    <div class="col" style="flex: 1;">
                        <div class="card">
                            <h2>Image Upload</h2>
                            <div class="dropzone" id="image-dropzone">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>Drag & drop images here or click to select files</p>
                            </div>
                            <input type="file" id="gallery-file-input" class="file-input" multiple accept="image/*">
                            
                            <h2 style="margin-top: 20px;">Gallery</h2>
                            <div class="gallery" id="product-gallery">
                                <!-- Gallery items will be added dynamically -->
                            </div>

                            <h2 style="margin-top: 20px;">Select Image</h2>
                            <div class="gallery-item" style="margin-top: 10px;" id="selected-image-container">
                                <!-- Selected image will be shown here -->
                                <div style="display: flex; align-items: center; justify-content: center; height: 100%;">
                                    <i class="fas fa-image" style="font-size: 24px; color: #ddd;"></i>
                                </div>
                            </div>

                            <button type="button" class="btn btn-secondary btn-block" style="margin-top: 20px;" id="upload-image-btn">
                                <i class="fas fa-upload"></i> Upload Image
                            </button>
                            <input type="file" id="main-file-input" class="file-input" accept="image/*">
                            
                            <button type="submit" class="btn btn-primary btn-block" style="margin-top: 30px;">
                                Submit Product
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        // DOM Elements
        const initialForm = document.getElementById('initial-form');
        const fullForm = document.getElementById('full-form');
        const initialTitle = document.getElementById('initial-title');
        const initialSlug = document.getElementById('initial-slug');
        const initialCategory = document.getElementById('initial-category');
        const initialBrand = document.getElementById('initial-brand');
        const createProductBtn = document.getElementById('create-product-btn');
        
        const fullTitle = document.getElementById('full-title');
        const fullSlug = document.getElementById('full-slug');
        const categoryTags = document.getElementById('category-tags');
        const categoryInput = document.getElementById('category-input');
        const fullBrand = document.getElementById('full-brand');
        
        const attributesContainer = document.getElementById('attributes-container');
        const addAttributeBtn = document.getElementById('add-attribute-btn');
        const generateVariationsBtn = document.getElementById('generate-variations-btn');
        const variationsContainer = document.getElementById('variations-container');
        
        const seoTitle = document.getElementById('seo-title');
        const productGallery = document.getElementById('product-gallery');
        const selectedImageContainer = document.getElementById('selected-image-container');
        
        const imageDropzone = document.getElementById('image-dropzone');
        const galleryFileInput = document.getElementById('gallery-file-input');
        const uploadImageBtn = document.getElementById('upload-image-btn');
        const mainFileInput = document.getElementById('main-file-input');
        
        const description = document.getElementById('description');
        const descriptionInput = document.getElementById('description-input');
        
        const fullProductForm = document.getElementById('full-product-form');

        // Fetch data from server
        let attributeValues = {};

        // Fetch categories
        async function fetchCategories() {
            try {
                const response = await fetch('/category-fetch/');
                if (!response.ok) {
                    throw new Error('Failed to fetch categories');
                }
                const categories = await response.json();
                
                // Populate category dropdowns
                const categoryOptions = categories.map(category => 
                    `<option value="${category.name}">${category.name}</option>`
                ).join('');
                
                initialCategory.innerHTML = '<option value="">Select Category</option>' + categoryOptions;
            } catch (error) {
                console.error('Error fetching categories:', error);
                // Fallback data if fetch fails
                const fallbackCategories = [
                    { value: 'errors', name: 'Something wrong. contact to developer.' }
                ];
                
                const categoryOptions = fallbackCategories.map(category => 
                    `<option value="${category.value}">${category.name}</option>`
                ).join('');
                
                initialCategory.innerHTML = '<option value="">Select Category</option>' + categoryOptions;
            }
        }

        // Fetch brands
        async function fetchBrands() {
            try {
                const response = await fetch('/brand-fetch');
                if (!response.ok) {
                    throw new Error('Failed to fetch brands');
                }
                const brands = await response.json();
                
                // Populate brand dropdowns
                const brandOptions = brands.map(brand => 
                    `<option value="${brand.name}">${brand.name}</option>`
                ).join('');
                
                initialBrand.innerHTML = '<option value="">Select Brand</option>' + brandOptions;
                fullBrand.innerHTML = '<option value="">Select Brand</option>' + brandOptions;
            } catch (error) {
                console.error('Error fetching brands:', error);
                // Fallback data if fetch fails
                const fallbackBrands = [
                    { value: 'error', name: 'Error loading brands' }
                ];
                
                const brandOptions = fallbackBrands.map(brand => 
                    `<option value="${brand.value}">${brand.name}</option>`
                ).join('');
                
                initialBrand.innerHTML = '<option value="">Select Brand</option>' + brandOptions;
                fullBrand.innerHTML = '<option value="">Select Brand</option>' + brandOptions;
            }
        }

        // Fetch attributes
        async function fetchAttributes() {
            try {
                const response = await fetch('/attributes');
                if (!response.ok) {
                    throw new Error('Failed to fetch attributes');
                }
                const attributes = await response.json();
                
                // Store attribute values for later use
                attributeValues = attributes.reduce((acc, attr) => {
                    acc[attr.value] = attr.values;
                    return acc;
                }, {});
                
                // Populate attribute dropdowns
                const attributeOptions = attributes.map(attr => 
                    `<option value="${attr.value}">${attr.name}</option>`
                ).join('');
                
                const attributeSelects = document.querySelectorAll('.attribute-select');
                attributeSelects.forEach(select => {
                    select.innerHTML = '<option value="">Select Attribute</option>' + attributeOptions;
                });
            } catch (error) {
                console.error('Error fetching attributes:', error);
                // Fallback data if fetch fails
                attributeValues = {
                    capacity: ['2 Pcs Set', '4 Pcs Set', '8 Pcs Set'],
                    color: ['Red', 'Blue', 'Green', 'Black', 'White'],
                    size: ['Small', 'Medium', 'Large', 'XL']
                };
                
                const fallbackAttributes = [
                    { value: 'capacity', name: 'Capacity' },
                    { value: 'color', name: 'Color' },
                    { value: 'size', name: 'Size' }
                ];
                
                const attributeOptions = fallbackAttributes.map(attr => 
                    `<option value="${attr.value}">${attr.name}</option>`
                ).join('');
                
                const attributeSelects = document.querySelectorAll('.attribute-select');
                attributeSelects.forEach(select => {
                    select.innerHTML = '<option value="">Select Attribute</option>' + attributeOptions;
                });
            }
        }

        // Load data when page loads
        window.addEventListener('DOMContentLoaded', function() {
            fetchCategories();
            fetchBrands();
            fetchAttributes();
        });

        // Auto-generate slug from title
        initialTitle.addEventListener('input', function() {
            const title = this.value;
            const slug = title.toLowerCase()
                .replace(/[^\w\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-');
            initialSlug.value = slug;
        });

        // Also update slug in full form when title changes
        fullTitle.addEventListener('input', function() {
            const title = this.value;
            const slug = title.toLowerCase()
                .replace(/[^\w\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-');
            fullSlug.value = slug;
        });

        // Product type selection
        const productTypeOptions = document.querySelectorAll('.product-type-option');
        productTypeOptions.forEach(option => {
            option.addEventListener('click', () => {
                productTypeOptions.forEach(opt => opt.classList.remove('active'));
                option.classList.add('active');
            });
        });

        // Create Product button click
        createProductBtn.addEventListener('click', function() {
            // Validate required fields
            if (!initialTitle.value || !initialCategory.value) {
                alert('Please fill in all required fields');
                return;
            }
            
            // Transfer data from initial form to full form
            fullTitle.value = initialTitle.value;
            fullSlug.value = initialSlug.value;
            seoTitle.value = initialTitle.value;
            
            // Set brand
            if (initialBrand.value) {
                fullBrand.value = initialBrand.value;
            }
            
            // Add category tag
            if (initialCategory.value) {
                const categoryText = initialCategory.options[initialCategory.selectedIndex].text;
                const categoryValue = initialCategory.value;
                addCategoryTag(categoryText, categoryValue);
            }
            
            // Show full form and hide initial form
            initialForm.style.display = 'none';
            fullForm.style.display = 'block';
        });

        // Add category tag function
        function addCategoryTag(text, value) {
            const tag = document.createElement('div');
            tag.className = 'tag';
            tag.innerHTML = `${text} <span class="close">×</span>`;
            tag.dataset.value = value;
            
            // Add event listener to close button
            tag.querySelector('.close').addEventListener('click', function() {
                tag.remove();
                updateCategoryInput();
            });
            
            categoryTags.appendChild(tag);
            updateCategoryInput();
        }
        
        // Update category input value
        function updateCategoryInput() {
            const tags = categoryTags.querySelectorAll('.tag');
            const values = Array.from(tags).map(tag => tag.dataset.value);
            categoryInput.value = values.join(',');
        }

        // Add attribute button click
        addAttributeBtn.addEventListener('click', function() {
            const attributeSections = attributesContainer.querySelectorAll('.attribute-section');
            const newIndex = attributeSections.length;
            
            // Create new attribute section
            const attributeSection = document.createElement('div');
            attributeSection.className = 'attribute-section';
            attributeSection.dataset.index = newIndex;
            
            attributeSection.innerHTML = `
                <div class="attribute-section-header">
                    <div class="attribute-section-title">Attribute ${newIndex + 1}</div>
                    <div class="attribute-section-remove"><i class="fas fa-times"></i></div>
                </div>
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label>Attribute</label>
                            <div class="select-wrapper">
                                <select class="form-control attribute-select" data-index="${newIndex}">
                                    <option value="">Select Attribute</option>
                                    ${Object.keys(attributeValues).map(attr => `<option value="${attr}">${attr.charAt(0).toUpperCase() + attr.slice(1)}</option>`).join('')}
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label>Value</label>
                            <div class="attribute-values" data-index="${newIndex}">
                                <!-- Values will be added dynamically based on selected attribute -->
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            attributesContainer.appendChild(attributeSection);
            
            // Add event listener to remove button
            const removeBtn = attributeSection.querySelector('.attribute-section-remove');
            removeBtn.addEventListener('click', function() {
                attributeSection.remove();
                updateAttributeSectionTitles();
            });
            
            // Show remove buttons if there are more than one attribute sections
            updateRemoveButtons();
            
            // Add event listener to attribute select
            const attributeSelect = attributeSection.querySelector('.attribute-select');
            attributeSelect.addEventListener('change', function() {
                const attribute = this.value;
                const index = this.dataset.index;
                const valuesContainer = document.querySelector(`.attribute-values[data-index="${index}"]`);
                
                updateAttributeValues(attribute, valuesContainer);
            });
        });
        
        // Update attribute section titles
        function updateAttributeSectionTitles() {
            const attributeSections = attributesContainer.querySelectorAll('.attribute-section');
            attributeSections.forEach((section, index) => {
                section.dataset.index = index;
                section.querySelector('.attribute-section-title').textContent = `Attribute ${index + 1}`;
                section.querySelector('.attribute-select').dataset.index = index;
                section.querySelector('.attribute-values').dataset.index = index;
            });
            
            updateRemoveButtons();
        }
        
        // Update remove buttons visibility
        function updateRemoveButtons() {
            const attributeSections = attributesContainer.querySelectorAll('.attribute-section');
            const showRemoveButtons = attributeSections.length > 1;
            
            attributeSections.forEach(section => {
                const removeBtn = section.querySelector('.attribute-section-remove');
                removeBtn.style.display = showRemoveButtons ? 'block' : 'none';
            });
        }
        
        // Update attribute values
        function updateAttributeValues(attribute, container) {
            container.innerHTML = '';
            
            if (attribute && attributeValues[attribute]) {
                attributeValues[attribute].forEach(value => {
                    const valueElement = document.createElement('div');
                    valueElement.className = 'attribute-value';
                    valueElement.textContent = value;
                    valueElement.dataset.value = value;
                    
                    // Add click event to toggle selection
                    valueElement.addEventListener('click', function() {
                        this.classList.toggle('selected');
                    });
                    
                    container.appendChild(valueElement);
                });
            }
        }
        
        // Initialize first attribute select
        const firstAttributeSelect = document.querySelector('.attribute-select');
        firstAttributeSelect.addEventListener('change', function() {
            const attribute = this.value;
            const index = this.dataset.index;
            const valuesContainer = document.querySelector(`.attribute-values[data-index="${index}"]`);
            
            updateAttributeValues(attribute, valuesContainer);
        });

        // Generate variations button click
        generateVariationsBtn.addEventListener('click', function() {
            // Get all attribute sections
            const attributeSections = attributesContainer.querySelectorAll('.attribute-section');
            
            // Create an array to store attribute data
            const attributeData = [];
            
            // Collect attribute data
            attributeSections.forEach(section => {
                const index = section.dataset.index;
                const attributeSelect = section.querySelector('.attribute-select');
                const attribute = attributeSelect.value;
                const attributeName = attribute ? attributeSelect.options[attributeSelect.selectedIndex].text : '';
                
                const valuesContainer = section.querySelector('.attribute-values');
                const selectedValues = Array.from(valuesContainer.querySelectorAll('.attribute-value.selected'))
                    .map(el => ({ value: el.dataset.value, text: el.textContent }));
                
                if (attribute && selectedValues.length > 0) {
                    attributeData.push({
                        attribute,
                        attributeName,
                        values: selectedValues
                    });
                }
            });
            
            // Check if we have attribute data
            if (attributeData.length === 0) {
                alert('Please select at least one attribute and value');
                return;
            }
            
            // Clear variations container
            variationsContainer.innerHTML = '';
            
            // Group variations by attribute
            attributeData.forEach((attrData, attrIndex) => {
                // Create a variations group for this attribute
                const variationsGroup = document.createElement('div');
                variationsGroup.className = 'variations-group';
                
                // Create group header
                const groupHeader = document.createElement('h3');
                groupHeader.textContent = attrData.attributeName + ' Variations';
                variationsGroup.appendChild(groupHeader);
                
                // Create variations for each value of this attribute
                attrData.values.forEach(value => {
                    createVariationRow(variationsGroup, attrData.attribute, attrData.attributeName, value.value, value.text);
                });
                
                // Add the group to the container
                variationsContainer.appendChild(variationsGroup);
            });
        });
        
        // Generate all possible combinations of attribute values
        function generateVariationCombinations(attributeData) {
            // Start with an empty array
            let combinations = [[]];
            
            // For each attribute
            attributeData.forEach(attr => {
                // Create a new array to store the new combinations
                const newCombinations = [];
                
                // For each existing combination
                combinations.forEach(combo => {
                    // For each value of the current attribute
                    attr.values.forEach(value => {
                        // Create a new combination by adding the current value to the existing combination
                        newCombinations.push([...combo, { 
                            attribute: attr.attribute, 
                            attributeName: attr.attributeName,
                            value: value.value, 
                            text: value.text 
                        }]);
                    });
                });
                
                // Replace the old combinations with the new ones
                combinations = newCombinations;
            });
            
            return combinations;
        }

        // Create variation row for a single attribute value
        function createVariationRow(container, attribute, attributeName, value, text) {
            const row = document.createElement('div');
            row.className = 'variation-row';
            
            // Create variation title
            const title = document.createElement('div');
            title.className = 'variation-title';
            
            // Create badge with attribute name
            const badge = document.createElement('span');
            badge.className = 'variation-title-badge';
            badge.textContent = attributeName;
            
            // Add badge and text to title
            title.appendChild(badge);
            title.appendChild(document.createTextNode(text));
            
            // Create content container
            const content = document.createElement('div');
            content.className = 'row';
            
            // Create image upload area
            const imageCol = document.createElement('div');
            imageCol.className = 'col';
            imageCol.style.flex = '0 0 100px';
            
            const imageUpload = document.createElement('div');
            imageUpload.className = 'variation-image';
            imageUpload.innerHTML = '<i class="fas fa-plus"></i>';
            
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.className = 'file-input';
            fileInput.accept = 'image/*';
            fileInput.name = `variation_image_${attribute}_${value.replace(/\s+/g, '_').toLowerCase()}`;
            
            // Add event listeners for image upload
            imageUpload.addEventListener('click', function() {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', function() {
                if (this.files && this.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        imageUpload.innerHTML = `<img src="${e.target.result}" alt="${text}">`;
                    };
                    reader.readAsDataURL(this.files[0]);
                }
            });
            
            imageCol.appendChild(imageUpload);
            imageCol.appendChild(fileInput);
            
            // Create form fields
            const fieldsCol = document.createElement('div');
            fieldsCol.className = 'col';
            
            // Create hidden input for variation data
            const variationDataInput = document.createElement('input');
            variationDataInput.type = 'hidden';
            variationDataInput.name = `variation_attributes[]`;
            variationDataInput.value = `${attribute}:${value}`;
            
            fieldsCol.appendChild(variationDataInput);
            
            // Create form fields HTML
            const fieldsHTML = `
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label>Stock Qty</label>
                            <input value="0" type="number" class="form-control" name="variation_stock_${attribute}_${value.replace(/\s+/g, '_').toLowerCase()}" placeholder="Quantity">
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label>Regular Price</label>
                            <input value="0" type="number" class="form-control" name="variation_regular_price_${attribute}_${value.replace(/\s+/g, '_').toLowerCase()}" placeholder="Regular Price">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label>Sale Price</label>
                            <input value="0" type="number" class="form-control" name="variation_sale_price_${attribute}_${value.replace(/\s+/g, '_').toLowerCase()}" placeholder="Sale Price">
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label>Purchase Price</label>
                            <input value="0" type="number" class="form-control" name="variation_purchase_price_${attribute}_${value.replace(/\s+/g, '_').toLowerCase()}" placeholder="Purchase Price">
                        </div>
                    </div>
                </div>
            `;
            
            fieldsCol.innerHTML += fieldsHTML;
            
            // Assemble the row
            content.appendChild(imageCol);
            content.appendChild(fieldsCol);
            
            row.appendChild(title);
            row.appendChild(content);
            
            container.appendChild(row);
        }

        // Rich text editor functionality
        function initRichTextEditor(toolbar, editor, hiddenInput) {
            const buttons = toolbar.querySelectorAll('button');
            
            buttons.forEach(button => {
                button.addEventListener('click', function() {
                    const command = this.dataset.command;
                    const value = this.dataset.value || null;
                    
                    if (command === 'createLink') {
                        const url = prompt('Enter the link URL:');
                        if (url) document.execCommand(command, false, url);
                    } else if (command === 'insertImage') {
                        const url = prompt('Enter the image URL:');
                        if (url) document.execCommand(command, false, url);
                    } else if (command === 'formatBlock') {
                        document.execCommand(command, false, value);
                    } else {
                        document.execCommand(command, false, null);
                    }
                    
                    // Update hidden input
                    hiddenInput.value = editor.innerHTML;
                });
            });
            
            // Update hidden input when editor content changes
            editor.addEventListener('input', function() {
                hiddenInput.value = this.innerHTML;
            });
        }
        
        // Initialize rich text editor
        initRichTextEditor(
            document.getElementById('description-toolbar'),
            document.getElementById('description'),
            document.getElementById('description-input')
        );

        // Dropzone functionality
        imageDropzone.addEventListener('click', function() {
            galleryFileInput.click();
        });
        
        imageDropzone.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.style.borderColor = '#f05a28';
        });
        
        imageDropzone.addEventListener('dragleave', function() {
            this.style.borderColor = '#ddd';
        });
        
        imageDropzone.addEventListener('drop', function(e) {
            e.preventDefault();
            this.style.borderColor = '#ddd';
            
            if (e.dataTransfer.files.length > 0) {
                galleryFileInput.files = e.dataTransfer.files;
                handleGalleryFiles(e.dataTransfer.files);
            }
        });
        
        // Gallery image upload
        galleryFileInput.addEventListener('change', function() {
            if (this.files && this.files.length > 0) {
                handleGalleryFiles(this.files);
            }
        });
        
        // Handle gallery files
        function handleGalleryFiles(files) {
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    addGalleryItem(e.target.result, file.name);
                };
                reader.readAsDataURL(file);
            });
        }
        
        // Add gallery item function
        function addGalleryItem(src, filename) {
            const item = document.createElement('div');
            item.className = 'gallery-item';
            
            const img = document.createElement('img');
            img.src = src;
            img.alt = 'Product image';
            
            const removeBtn = document.createElement('div');
            removeBtn.className = 'remove';
            removeBtn.innerHTML = '<i class="fas fa-times"></i>';
            
            // Create hidden input for the image
            const hiddenInput = document.createElement('input');
            hiddenInput.type = 'hidden';
            hiddenInput.name = 'gallery_images[]';
            hiddenInput.value = src;
            
            // Add event listener to remove button
            removeBtn.addEventListener('click', function(e) {
                e.stopPropagation(); // Prevent triggering the click on the gallery item
                item.remove();
            });
            
            // Add event listener to select image
            item.addEventListener('click', function() {
                selectedImageContainer.innerHTML = '';
                const selectedImg = document.createElement('img');
                selectedImg.src = src;
                selectedImg.alt = 'Selected product image';
                selectedImageContainer.appendChild(selectedImg);
                
                // Set hidden input for main image
                const mainImageInput = document.getElementById('main-image-input') || document.createElement('input');
                mainImageInput.type = 'hidden';
                mainImageInput.id = 'main-image-input';
                mainImageInput.name = 'main_image';
                mainImageInput.value = src;
                
                if (!document.getElementById('main-image-input')) {
                    selectedImageContainer.appendChild(mainImageInput);
                }
            });
            
            item.appendChild(img);
            item.appendChild(removeBtn);
            item.appendChild(hiddenInput);
            
            productGallery.appendChild(item);
        }
        
        // Main image upload
        uploadImageBtn.addEventListener('click', function() {
            mainFileInput.click();
        });
        
        mainFileInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    selectedImageContainer.innerHTML = '';
                    const selectedImg = document.createElement('img');
                    selectedImg.src = e.target.result;
                    selectedImg.alt = 'Selected product image';
                    selectedImageContainer.appendChild(selectedImg);
                    
                    // Set hidden input for main image
                    const mainImageInput = document.createElement('input');
                    mainImageInput.type = 'hidden';
                    mainImageInput.id = 'main-image-input';
                    mainImageInput.name = 'main_image';
                    mainImageInput.value = e.target.result;
                    selectedImageContainer.appendChild(mainImageInput);
                };
                reader.readAsDataURL(this.files[0]);
            }
        });

        // Form submission
        fullProductForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Update hidden input for rich text editor
            descriptionInput.value = description.innerHTML;
            
            // Collect form data
            const formData = new FormData(this);
            
            // Convert FormData to object for console logging
            const formDataObj = {};
            formData.forEach((value, key) => {
                // If the key already exists, convert it to an array
                if (formDataObj[key]) {
                    if (!Array.isArray(formDataObj[key])) {
                        formDataObj[key] = [formDataObj[key]];
                    }
                    formDataObj[key].push(value);
                } else {
                    formDataObj[key] = value;
                }
            });
             
            // Log form data
            document.getElementById('loading-spinner').classList.remove('hidden');
            
            fetch('/create-product/', {
        method: 'POST',
        headers: {
            'X-CSRFToken': getCookie('csrftoken')  // Include CSRF token
        },
        body: formData
    })
    .then(response => {
        document.getElementById('loading-spinner').classList.add('hidden'); // Hide spinner
        if (response.ok) {
            return response.json();
        }
        throw new Error('Network response was not ok.');
    })
    .then(data => {
        showToast('Product created successfully!', 'success');
        setTimeout(() => location.reload(), 2000); // Reload after 2 sec
    })
    .catch(error => {
        showToast(error, 'error');
    });
});

// Function to show toast message
function showToast(message, type) {
    let toast = document.getElementById('toast');
    toast.textContent = message;
    toast.className = `fixed bottom-5 right-5 px-4 py-2 rounded shadow-lg text-white ${
        type === 'success' ? 'bg-green-500' : 'bg-red-500'
    }`;
    toast.classList.remove('hidden');

    setTimeout(() => {
        toast.classList.add('hidden');
    }, 3000);
}
        // Initialize with sample data for demo

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.startsWith(name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}


    </script>


{% endblock %}

